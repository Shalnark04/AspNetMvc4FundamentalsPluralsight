@{
    ViewBag.Title = "Home Page";
}

<!--html to be displayed-->
<div id="videoTableOutput">

</div>

@*html template*@
<script id="videoTable" type="text/html">

    <table>
        <thead>
        <th>Title</th>
        <th>Length</th>
        </thead>
        <tbody>
            {{#each video}}
            <tr data-id="{{Id}}">
                <td>{{Title}}</td>
                <td>{{Length}}</td>
                <td>
                    <button class="editVideo">Edit</button>
                    <button class="deletVideo">Delete</button>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>

</script>

@section scripts{

    <script src="~/Scripts/handlebars.min.js"></script>

    <script>

        var videoServer = (function () {

            //get the 'videos' api url
            var videoApiUrl = '@Url.RouteUrl("DefaultApi", new { httproute="", controller="videos"})';

            //if anything will go wrong with accessing the server, display the errer
            $(document).ajaxError(function (event, xhr) {
                alert(xhr.status + ":" + xhr.statusText);
            });

            //once the method called, fire ajax request to get all videos
            var getVideos = function () {
                return $.ajax(videoApiUrl);
            };

            //sets property to vall local method
            return {
                getVideos: getVideos,
            };

        }());

        (function () {

            var templates = {};

            var compileTemplates = function () {
                templates.videoTable = Handlebars.compile($("#videoTable").html());
            }

            var showAllVideos = function (data) {
                var output = templates.videoTable({ video: data });
                $("#videoTableOutput").html(output);
            }

            var refreshVideos = function () {
                videoServer.getVideos().done(showAllVideos);
            };

            //once DOM ready, call the method
            $(function () {
                compileTemplates();
                refreshVideos();
            });

        }());

    </script>



}